<%*
//å‘¨è®°æ–‡ä»¶åæ ¼å¼
//å‘¨è®°æ–‡ä»¶åå¿…é¡»åŒ…å«å¹´ä»½å’Œå‘¨æ•°
//yyyy = å¹´ä»½ï¼ˆä¾‹å¦‚ï¼š2023ï¼‰
//ww   = å‘¨æ•°ï¼ˆä¾‹å¦‚ï¼š19ï¼‰
let weekFileFormat = "å‘¨è®°ï¼šyyyyå¹´wwå‘¨";

//æ ¹æ®æ–‡ä»¶åè·å–å½“å‰å¹´ä»½å’Œå‘¨
const fileName = tp.file.title;
const year = fileName.substring(weekFileFormat.indexOf("yyyy"),weekFileFormat.indexOf("yyyy") + 4);
//å‘¨è®¡ç®—é—®é¢˜ï¼Œå¯èƒ½è¦ï¼Ÿ+1å‘¨
const week = parseInt(fileName.substring(weekFileFormat.indexOf("ww"),weekFileFormat.indexOf("ww") + 2));

// æ­¤å¹´1å·æ˜¯æ˜ŸæœŸå‡ 
let firstDay = new Date(year,0,1).getDay()
// æ–¹ä¾¿è®¡ç®—ï¼Œå½“ä¸ºæ˜ŸæœŸå¤©æ—¶ä¸º7
if(firstDay == 0){
    firstDay = 7;
}

let oneFirstDay;
let oneLastDay;
// å¦‚æœ1å·åˆšå¥½æ˜¯æ˜ŸæœŸä¸€
if(firstDay == 1){
     oneFirstDay = year + '-01-01'
     oneLastDay = year + '-01-07'
} else {
    let jj = 8 - firstDay
    oneFirstDay = (year - 1) + '-12-' + (31 - firstDay + 2 > 9 ? 31 - firstDay + 2 : '0' + (31 - firstDay + 2))
    oneLastDay = year + '-01-' + (jj > 9 ? jj : '0' + jj)
}

let weekFirstDay;
let weekLastDay;
// å¦‚æœåˆšå¥½æ˜¯ç¬¬ä¸€å‘¨
if(week == 1){
    weekFirstDay = oneFirstDay
    weekLastDay = oneLastDay
}else{
    weekFirstDay = addDate(oneLastDay,(week - 2) * 7 + 1)
    weekLastDay = addDate(oneLastDay,(week - 1) * 7)
}

//æ—¥æœŸåŠ å‡æ³•  dateå‚æ•°ä¸ºè®¡ç®—å¼€å§‹çš„æ—¥æœŸï¼Œdaysä¸ºéœ€è¦åŠ çš„å¤©æ•°   
//æ ¼å¼:addDate('2017-1-11',20) 
function addDate(date,days){ 
    var d=new Date(date); 
    d.setDate(d.getDate()+days); 
    var m=d.getMonth()+1; 
    return d.getFullYear()+'-'+(m>9?m:'0'+m)+'-'+(d.getDate()>9?d.getDate():'0'+d.getDate()); 
}
-%>
---
weekFirstDay: <% weekFirstDay %>
weekLastDat: <% weekLastDay %>
create: <% tp.file.creation_date () %>
tag: å‘¨è®°
---
```dataviewjs
//æ—¥è®°æ–‡ä»¶åæ ¼å¼ï¼ˆå®šä¹‰æˆä½ è‡ªå·±æ—¥è®°æ–‡ä»¶åçš„æ ¼å¼ï¼Œæ›¿æ¢å…¶ä¸­çš„å˜é‡ï¼‰
//yyyy = å¹´ä»½ï¼ˆä¾‹å¦‚ï¼š2023ï¼‰
//m    = è‡ªé€‚åº”ä½æ•°æœˆä»½ï¼ˆä¾‹å¦‚ï¼š3ã€10ï¼‰
//mm   = ä¸¤ä½æ•°æœˆä»½ï¼ˆä¾‹å¦‚ï¼š03ã€10ï¼‰
//d    = è‡ªé€‚åº”ä½æ•°æ—¥æœŸï¼ˆä¾‹å¦‚ï¼š3ã€10ï¼‰
//dd   = ä¸¤ä½æ•°æ—¥æœŸï¼ˆä¾‹å¦‚ï¼š03ã€10ï¼‰
let dailyFileFormat = "æ—¥è®°ï¼šyyyyå¹´mæœˆdæ—¥";
//æ—¥è®°æ–‡ä»¶å¤¹è·¯å¾„
const dailyFilePath = "003.è‡ªæˆ‘/æ—¥è®°";

//æ—¥æŠ¥æ–‡ä»¶åæ ¼å¼ï¼ˆå®šä¹‰æˆä½ è‡ªå·±æ—¥æŠ¥æ–‡ä»¶åçš„æ ¼å¼ï¼Œæ›¿æ¢å…¶ä¸­çš„å˜é‡ï¼‰
//yyyy = å¹´ä»½ï¼ˆä¾‹å¦‚ï¼š2023ï¼‰
//m    = è‡ªé€‚åº”ä½æ•°æœˆä»½ï¼ˆä¾‹å¦‚ï¼š3ã€10ï¼‰
//mm   = ä¸¤ä½æ•°æœˆä»½ï¼ˆä¾‹å¦‚ï¼š03ã€10ï¼‰
//d    = è‡ªé€‚åº”ä½æ•°æ—¥æœŸï¼ˆä¾‹å¦‚ï¼š3ã€10ï¼‰
//dd   = ä¸¤ä½æ•°æ—¥æœŸï¼ˆä¾‹å¦‚ï¼š03ã€10ï¼‰
let dailyWorkFileFormat = "æ—¥æŠ¥ï¼šyyyyå¹´mæœˆdæ—¥";
//æ—¥è®°æ–‡ä»¶å¤¹è·¯å¾„
const dailyWorkFilePath = "002.å·¥ä½œ/å·¥ä½œè®°å½•/æ—¥æŠ¥";

const weekFirstDay = dv.current().weekFirstDay;
const weekLastDat = dv.current().weekLastDat;
const weekday=["æ˜ŸæœŸæ—¥","æ˜ŸæœŸä¸€","æ˜ŸæœŸäºŒ","æ˜ŸæœŸä¸‰","æ˜ŸæœŸå››","æ˜ŸæœŸäº”","æ˜ŸæœŸå…­"];

//æœ¬å‘¨æ—¥ç¨‹è¾“å‡º
let resultText = "";

//ç”¨äºæ¦‚è¦ç»Ÿè®¡
let dailyCountComplete = 0;
let dailyCountFail = 0;
let workCountComplete = 0;
let workCountFail = 0;
let docCount = 0;
for(var i = 0;i <= 6; i++){
    const nowDate = new Date(weekFirstDay);
    nowDate.setDate(nowDate.getDate() + i);

    //å½“å¤©æœ‰æ—¥è®°æ‰ç”Ÿæˆæ•°æ®
    const dayFile = dv.page(dailyFilePath + "/" + formatDailyFileName(nowDate,dailyFileFormat) +".md");
    if(dayFile != null){
        //æ ‡é¢˜
        resultText += "\n";
        resultText += "> [!TIP]- " +  weekday[nowDate.getDay()] +"\n> <span style='color: #72e9fd;font-weight:bold'>ğŸ“—[[" + dayFile.file.path + "|"+dayFile.file.name+"]]</span>\n";
    
        //æ—¥ç¨‹
        resultText += ">> [!SUCCESS] æ—¥ç¨‹è¡¨\n"
        if(dayFile != null && dayFile.file != null){
            const dayTask = dayFile.file.tasks;
            for(var rc = 0;rc < dayTask.length;rc ++){
                dayTask[rc].status == "x" ? dailyCountComplete++ : dailyCountFail++;
                resultText += ">> "+dayTask[rc].symbol+" ["+dayTask[rc].status+"] "+dayTask[rc].text+"\n";
            }
        }
        
        //å·¥ä½œ
        resultText += " > "
        resultText += "\n >> [!example] å·¥ä½œé¡¹\n"
        const dayWorkFile = dv.page(dailyWorkFilePath + "/" + formatDailyFileName(nowDate,dailyWorkFileFormat) +".md");
        if(dayWorkFile != null && dayWorkFile.file != null){
            const dayTask = dayWorkFile.file.tasks;
            for(var gz = 0;gz < dayTask.length;gz ++){
                dayTask[gz].status == "x" ? workCountComplete++ : workCountFail++;
                resultText += ">> "+dayTask[gz].symbol+" ["+dayTask[gz].status+"] "+dayTask[gz].text+"\n";
            }
        }
    
    
        //æ–‡ç« 
        resultText += " >"
        resultText += "\n >> [!NOTE] æ–°æ–‡ç« \n";
        const dayNewDoc = dv.pages().where(file => {
            const fileDate = new Date(file.file.cday);
            return (fileDate.getDate() == nowDate.getDate() && fileDate.getMonth() == nowDate.getMonth() && fileDate.getFullYear() && nowDate.getFullYear());
    })
        for(var j = 0;j<dayNewDoc.length;j++){
            docCount++;
            resultText += ">> - [[ " + dayNewDoc[j].file.path + "|"+dayNewDoc[j].file.name+" ]]\n";
        }
    }
    
}

//è¾“å‡º-æœ¬å‘¨æ¦‚è¦
dv.header(3,"æœ¬å‘¨æ¦‚è¦")
let summaryResult = "> [!SUCCESS] å…±å®Œæˆ \n" +
"> - ğŸŒæ—¥ç¨‹ï¼š<span style='color: #82eb82;font-weight:bold'>"+dailyCountComplete+"</span> \n" +
"> - ğŸ’¼å·¥ä½œä»»åŠ¡ï¼š<span style='color: #82eb82;font-weight:bold'>"+workCountComplete+"</span> \n" +
"> - âœ’ï¸æ–°æ–‡ç« ï¼š<span style='color: #82eb82;font-weight:bold'>"+docCount+"</span> \n" +
"> \n" +
">> [!FAIL]- æœªå®Œæˆ \n" +
">> - ğŸŒæ—¥ç¨‹ï¼š<span style='color: #f078a0;font-weight:bold'>"+dailyCountFail+"</span> \n" +
">> - ğŸ’¼å·¥ä½œä»»åŠ¡ï¼š<span style='color: #f078a0;font-weight:bold'>"+workCountFail+"</span> \n";
dv.span(summaryResult)
//è¾“å‡º-æœ¬å‘¨æ—¥ç¨‹
dv.header(3,"æœ¬å‘¨æ—¥ç¨‹")
dv.span(resultText)
//è¾“å‡º-è¡¥å……å†…å®¹
dv.header(3,"æœ¬å‘¨æ€»ç»“")

//æ–‡ä»¶åæ—¥æœŸæ ¼å¼åŒ–
function formatDailyFileName(date,format){
    const dateYear = date.getFullYear();
    const dateMonth = date.getMonth() + 1;
    const dateDate = date.getDate();
    return format
        .replace("yyyy",dateYear)
        .replace("mm",dateMonth < 10 ? '0' + dateMonth : dateMonth)
        .replace("m",dateMonth)
        .replace("dd",dateDate < 10 ? '0' + dateDate : dateDate)
        .replace("d",dateDate)
}
```