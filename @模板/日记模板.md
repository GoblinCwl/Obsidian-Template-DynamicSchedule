<%*
    //ä»Šå¤©æ—¥æœŸ
    let today = new Date();
    //é¢„è¾“å‡ºå˜é‡
    let taskListStr = "";

    //æ—¥è®°æ–‡ä»¶åæ ¼å¼ï¼ˆå®šä¹‰æˆä½ è‡ªå·±æ—¥è®°æ–‡ä»¶åçš„æ ¼å¼ï¼Œæ›¿æ¢å…¶ä¸­çš„å˜é‡ï¼‰
    //yyyy = å¹´ä»½ï¼ˆä¾‹å¦‚ï¼š2023ï¼‰
    //m    = è‡ªé€‚åº”ä½æ•°æœˆä»½ï¼ˆä¾‹å¦‚ï¼š3ã€10ï¼‰
    //mm   = ä¸¤ä½æ•°æœˆä»½ï¼ˆä¾‹å¦‚ï¼š03ã€10ï¼‰
    //d    = è‡ªé€‚åº”ä½æ•°æ—¥æœŸï¼ˆä¾‹å¦‚ï¼š3ã€10ï¼‰
    //dd   = ä¸¤ä½æ•°æ—¥æœŸï¼ˆä¾‹å¦‚ï¼š03ã€10ï¼‰
    let dailyFileFormat = "æ—¥è®°ï¼šyyyyå¹´mæœˆdæ—¥";

    //æ—¶é—´æ®µ
    const timeRegionArray = [
        "00:00|04:59|å‡Œæ™¨",
        "05:00|08:59|æ—©æ™¨",
        "09:00|11:29|ä¸Šåˆ",
        "11:30|13:29|ä¸­åˆ",
        "13:30|17:59|ä¸‹åˆ",
        "18:00|23:59|æ™šä¸Š",
    ];
    //æ¯æ—¥ä»»åŠ¡æ¸…å•ï¼Œé¢„è¾“å…¥å›ºå®šçš„æ¯æ—¥ä»»åŠ¡
    let taskArray = [
        "07:20|ğŸŒèµ·åºŠ",
        "07:25|ğŸª¥å–ä¸€æ¯æ°´ï¼Œæ´—æ¼±",
        "07:30|ğŸµ**æ³¡èŒ¶**",
        "12:25|ğŸ‘€çœ¼ä¿å¥æ“",
        "12:30|ğŸ’¤åˆç¡",
        "21:30|ğŸ“šè‡ªè€ƒå­¦ä¹ ",
        "23:15|ğŸ¥›çƒ­ç‰›å¥¶",
        "23:50|ğŸŒ™æ´—æ¼±ï¼Œæ—©ç¡",
    ];
    //å‘¨å¸¸ä»»åŠ¡æ¸…å•
    let weekTaskArray = [{},[],[],[],[],[],[],[]];
    //æƒ³æŠŠä»»åŠ¡åŠ åœ¨å‘¨å‡ ï¼Œæ•°å­—å°±å¡«å‡ 
    weekTaskArray[4].push("09:00|ğŸ—ç–¯ç‹‚æ˜ŸæœŸå››");
    weekTaskArray[5].push("17:00|ğŸ“°**å‘¨æŠ¥**");
    weekTaskArray[6].push("16:00|ğŸ“**ç»™å¦ˆå¦ˆæ‰“ç”µè¯**");
    weekTaskArray[7].push("17:00|ğŸ§¹*æ•´ç†ç¯å¢ƒ*");
    weekTaskArray[7].push("22:00|ğŸ—’ï¸**å‘¨è®°**");
    //å‘¨å¸¸ä»»åŠ¡æ·»åŠ 
    taskArray.push.apply(taskArray,weekTaskArray[(today.getDay() == 0 ? 7 : today.getDay())]);

    //æœˆä»»åŠ¡æ¸…å•
    let monthTaskArray = [{},[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]];
    //æƒ³æŠŠä»»åŠ¡åŠ åœ¨æ¯æœˆå‡ å·ï¼Œæ•°å­—å°±å¡«å‡ 
    monthTaskArray[10].push("17:00|ğŸ—’ğŸ’´å‘å·¥èµ„å’¯~");
    monthTaskArray[18].push("22:00|ğŸ—’ğŸ›©ï¸å‘å¸ƒæµ‹è¯•é¡¹ç›®");
    //æœˆä»»åŠ¡æ·»åŠ 
    taskArray.push.apply(taskArray,monthTaskArray[today.getDate()]);

    //æ’æœŸè®¡åˆ’æ–‡ä»¶åï¼ˆä¸èƒ½å’Œå…¶ä»–æ–‡ä»¶é‡åï¼‰
    const planFile = tp.file.find_tfile("æ’æœŸè®¡åˆ’");
    //ç”Ÿæˆæ—¥ç¨‹åæ’æœŸè®¡åˆ’å†…å½“å¤©çš„ä»»åŠ¡æ˜¯å¦åˆ é™¤(true=åˆ é™¤ï¼Œfalse=ä¸åˆ é™¤)
    const planFileRemoveFlg = true;
    //æ’æœŸè®¡åˆ’ä¸­æœªæŒ‡å®šç²¾ç¡®æ—¶é—´çš„ä»»åŠ¡åº”è¯¥åœ¨å“ªä¸ªæ—¶é—´ç‚¹
    const planDefaultTaskTime = "09:00";

    //åŠ¨æ€ä»»åŠ¡ï¼Œéœ€è¦ç‹¬ç«‹åˆ¤æ–­
    //æ˜¨å¤©æ—¥æœŸ
    let yesterdayDate = new Date(today);
    yesterdayDate.setDate(today.getDate() - 1);

    // æ˜¨å¤©æ—¥è®°æ–‡ä»¶å
    let fullFileName = formatDailyFileName(yesterdayDate,dailyFileFormat);

    const file = tp.file.find_tfile(fullFileName);
    if(file != null){
        const content = await app.vault.cachedRead(file);
        const contentStr = content.toString();
        // éš”ä¸€å¤©è·‘æ­¥æ•£æ­¥
        if(contentStr.contains("- [x] 20:30 ğŸ‘Ÿè·‘æ­¥")){
            taskArray.push("20:30|ğŸ‘æ•£æ­¥");
        }else{
            taskArray.push("20:30|ğŸ‘Ÿè·‘æ­¥");
        }
    }

    //æ’æœŸè®¡åˆ’æ£€ç´¢
    let planTask = "";
    if(planFile != null){
        const content = await app.vault.cachedRead(planFile);
        //åˆ†è¡Œ
        const lineArray = content.split("\n");
        const dateTitle = today.getFullYear()+"å¹´"+(today.getMonth()+1)+"æœˆ"+today.getDate()+"æ—¥";
        let modifyLabel = [];
        for(var i = 0;i < lineArray.length;i++){
            const nowLine = lineArray[i];
            if(nowLine.startsWith("## " + dateTitle)){
                modifyLabel.push(nowLine);
                //å¾ªç¯è¿™å¤©æ ‡ç­¾ä¸‹çš„ä»»åŠ¡
                for(var j = 1;j < lineArray.length - i;j++){
                    let lineTask = lineArray[i+j];
                    //ç¢°åˆ°ç©ºç™½è¡Œå’Œ#å¼€å¤´åˆ™é€€å‡ºå¾ªç¯
                    if(lineTask.length <= 0 || lineTask.startsWith("## ")){
                        break;
                    }
                    //å¦‚æœæ²¡æœ‰å†’å·ï¼Œè¡¨ç¤ºæœªè®¾ç½®æ—¶é—´ï¼Œé»˜è®¤è®¾ç½®planDefaultTaskTime
                    if(lineTask.indexOf(":") == -1){
                        lineTask = lineTask.replace("- [ ]","- [ ] " + planDefaultTaskTime);
                    }
                    //åŠ å…¥ä»»åŠ¡
                    taskArray.push(lineTask.replace("- [ ] ","").replace(" ","|"));
                    //åŠ å…¥åŸæ–‡åˆ°å¾…ä¿®æ”¹
                    modifyLabel.push(lineArray[i+j]);
                }
            }
        }

        let modifyContent = content;
        for(var i = 0;i < modifyLabel.length;i++){
            modifyContent = modifyContent.replace(modifyLabel[i] + "\n","");
            modifyContent = modifyContent.replace(modifyLabel[i],"");
        }
        //åˆ é™¤æ’æœŸè®¡åˆ’ä¸­è¿™æ¬¡ç”Ÿæˆä»»åŠ¡çš„æ—¥æœŸç»„
        if(planFileRemoveFlg){
            app.vault.modify(planFile,modifyContent);
        }
    }


    //---------æ±‡æ€»ä»»åŠ¡æ•°æ®---------\\
    //ä»»æ„æ—¥æœŸï¼Œåˆ¤æ–­ç”¨ä¸åˆ°ï¼Œå› ä¸ºæ¯æ—¥æ¸…å•åªå¯¹ä¸€å¤©çš„æ—¶é—´å¤„ç†ï¼ˆåé¢æœ‰ä¸ªç©ºæ ¼ï¼Œç”¨äºDateæ ¼å¼è¯†åˆ«ï¼‰
    const placeholderDate = "2000-09-05 ";
    //æ ¹æ®æ—¶é—´å¯¹ä»»åŠ¡æ’åº
    taskArray.sort(function(task1,task2) {
        let task1Time = new Date(placeholderDate + task1.split("|")[0]);
        let task2Time = new Date(placeholderDate + task2.split("|")[0]);
        return task1Time > task2Time ? 1 : -1;
    });
    //éå†ä¸åŒçš„æ—¶é—´æ®µï¼Œç”Ÿæˆä»»åŠ¡æ¸…å•
    for(var i = 0;i < timeRegionArray.length;i++){
        const nowTimeRegion = timeRegionArray[i].split("|");
        const nowTimeRegionStartDate = new Date(placeholderDate + nowTimeRegion[0])
        const nowTimeRegionEndDate = new Date(placeholderDate + nowTimeRegion[1])
        //åœ¨ä»»åŠ¡æ¸…å•ä¸­å¯»æ‰¾å½“å‰æ—¶é—´æ®µçš„ä»»åŠ¡
        let nowTimeRegionTaskArray = taskArray.filter(task => {
            let taskTime = new Date(placeholderDate + task.split("|")[0]);
            return (taskTime >= nowTimeRegionStartDate && taskTime <= nowTimeRegionEndDate);
        });
        if(nowTimeRegionTaskArray.length > 0){
            taskListStr += ("### " + nowTimeRegion[2] + "\n");
            for(var j = 0;j < nowTimeRegionTaskArray.length;j++){
                taskListStr += ("- [ ] " + nowTimeRegionTaskArray[j].replace("|"," ") + "\n");
            }
        }
    }

    //æ–‡ä»¶åæ—¥æœŸæ ¼å¼åŒ–
    function formatDailyFileName(date,format){
        const dateYear = date.getFullYear();
        const dateMonth = date.getMonth() + 1;
        const dateDate = date.getDate();
        return format
            .replace("yyyy",dateYear)
            .replace("mm",dateMonth < 10 ? '0' + dateMonth : dateMonth)
            .replace("m",dateMonth)
            .replace("dd",dateDate < 10 ? '0' + dateDate : dateDate)
            .replace("d",dateDate)
    }
-%>
---
create: <% tp.file.creation_date () %>
tag: æ—¥è®°,#todo/æ—¥å¸¸
---
<% taskListStr %>
```dataviewjs
//ã€ä»Šæ—¥å·¥ä½œã€‘è·å–

//æ—¥æŠ¥æ–‡ä»¶åæ ¼å¼ï¼ˆå®šä¹‰æˆä½ è‡ªå·±çš„æ ¼å¼ï¼Œæ›¿æ¢å…¶ä¸­çš„å˜é‡ï¼‰
//yyyy = å¹´ä»½ï¼ˆä¾‹å¦‚ï¼š2023ï¼‰
//m    = è‡ªé€‚åº”ä½æ•°æœˆä»½ï¼ˆä¾‹å¦‚ï¼š3ã€10ï¼‰
//mm   = ä¸¤ä½æ•°æœˆä»½ï¼ˆä¾‹å¦‚ï¼š03ã€10ï¼‰
//d    = è‡ªé€‚åº”ä½æ•°æ—¥æœŸï¼ˆä¾‹å¦‚ï¼š3ã€10ï¼‰
//dd   = ä¸¤ä½æ•°æ—¥æœŸï¼ˆä¾‹å¦‚ï¼š03ã€10ï¼‰
let dailyWorkFileFormat = "æ—¥æŠ¥ï¼šyyyyå¹´mæœˆdæ—¥";
//æ—¥æŠ¥æ–‡ä»¶å¤¹ç›®å½•
let dailyWorkFilePath = "002.å·¥ä½œ/å·¥ä½œè®°å½•/æ—¥æŠ¥";


//è·å–å½“å¤©æ—¥æŠ¥
const fileToday = new Date(dv.current().create);
const file = dv.page(dailyWorkFilePath + "/" + formatDailyFileName(fileToday,dailyWorkFileFormat));
if(file != null){
    dv.header("3","ä»Šæ—¥å·¥ä½œ")
    dv.taskList(file.file.tasks,false)
}
//æ–‡ä»¶åæ—¥æœŸæ ¼å¼åŒ–
function formatDailyFileName(date,format){
    const dateYear = date.getFullYear();
    const dateMonth = date.getMonth() + 1;
    const dateDate = date.getDate();
    return format
        .replace("yyyy",dateYear)
        .replace("mm",dateMonth < 10 ? '0' + dateMonth : dateMonth)
        .replace("m",dateMonth)
        .replace("dd",dateDate < 10 ? '0' + dateDate : dateDate)
        .replace("d",dateDate)
}
```
```dataviewjs
//ã€ä»Šæ—¥æ–‡ç« ã€‘è·å–
//è·å–å½“å¤©åˆ›å»ºçš„æ–‡ä»¶
const fileToday = new Date(dv.current().create);
const todayFileArray = dv.pages().where(file => {
    const fileDate = new Date(file.file.cday);
    return (fileDate.getDate() == fileToday.getDate() && fileDate.getMonth() == fileToday.getMonth() && fileDate.getFullYear() && fileToday.getFullYear());
})

if(todayFileArray.length > 0){
    dv.header("3","ä»Šæ—¥æ–‡ç« ")
}
for(var i = 0;i<todayFileArray.length;i++){
    dv.el("li","[[ " + todayFileArray[i].file.path + "|"+todayFileArray[i].file.name+" ]]\n");
}
```
### ç»“è¯­
ç»“æŸäº†{{DATE:yyyyå¹´MMMDæ—¥}}ã€‚